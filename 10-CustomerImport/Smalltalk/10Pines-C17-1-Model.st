Object subclass: #Address	instanceVariableNames: 'id streetName streetNumber town zipCode province'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!Address methodsFor: 'accessing' stamp: 'HernanWilkinson 10/28/2016 16:11'!province	^province! !!Address methodsFor: 'accessing' stamp: 'HernanWilkinson 10/28/2016 16:12'!streetName	^streetName ! !!Address methodsFor: 'accessing' stamp: 'HernanWilkinson 10/28/2016 16:12'!streetNumber	^streetNumber ! !!Address methodsFor: 'accessing' stamp: 'HernanWilkinson 10/28/2016 16:12'!town	^town! !!Address methodsFor: 'accessing' stamp: 'HernanWilkinson 10/28/2016 16:13'!zipCode	^zipCode! !!Address methodsFor: 'comparing' stamp: 'JulianBayardo 11/7/2017 00:00'!= anAddress	^ self streetName = anAddress streetName and: (self streetNumber = anAddress streetNumber and: (self town = anAddress town and: (self zipCode = anAddress zipCode and: (self province = anAddress province)))).! !!Address methodsFor: 'comparing' stamp: 'JulianBayardo 11/7/2017 00:08'!hash	^ self streetName hash		bitXor:			(self streetNumber hash bitXor: (self town hash bitXor: (self zipCode hash bitXor: self province hash)))! !!Address methodsFor: 'initialization' stamp: 'JulianBayardo 11/6/2017 23:57'!initializeStreet: aStreetName number: aStreetNumber town: aTownName province: aProvinceName zipCode: aZipCode	streetName := aStreetName.	streetNumber := aStreetNumber.	town := aTownName.	province := aProvinceName .	zipCode := aZipCode.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Address class	instanceVariableNames: ''!!Address class methodsFor: 'as yet unclassified' stamp: 'JulianBayardo 11/6/2017 23:55'!street: aStreetName number: aStreetNumber town: aTownName province: aProvinceName zipCode: aZipCode	^ self new initializeStreet: aStreetName number: aStreetNumber town: aTownName province: aProvinceName zipCode: aZipCode! !Object subclass: #Customer	instanceVariableNames: 'id firstName lastName identificationType identificationNumber addresses identification'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 16:15'!lastName	^lastName ! !!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 16:15'!firstName		^firstName ! !!Customer methodsFor: 'initialization' stamp: 'JulianBayardo 11/7/2017 00:20'!initialize	addresses := OrderedCollection new! !!Customer methodsFor: 'initialization' stamp: 'JulianBayardo 11/7/2017 00:17'!initializeFirst: aFirstName last: aLastName identificationType: anIdentificationType identificationNumber: anIdentificationNumber	firstName := aFirstName.	lastName := aLastName.	identificationNumber := anIdentificationNumber .	identificationType := anIdentificationType .! !!Customer methodsFor: 'comparing' stamp: 'JulianBayardo 11/7/2017 00:30'!= aCustomer	^ self identificationType = aCustomer identificationType		and:			(self identificationNumber = aCustomer identificationNumber				and: (self addresses = aCustomer addresses))! !!Customer methodsFor: 'comparing' stamp: 'JulianBayardo 11/7/2017 00:20'!hash	^ self identificationType hash bitXor: (self identificationNumber hash bitXor: self addresses hash).! !!Customer methodsFor: 'identification' stamp: 'HernanWilkinson 10/28/2016 16:13'!identificationType		^identificationType ! !!Customer methodsFor: 'identification' stamp: 'HernanWilkinson 10/28/2016 16:13'!identificationNumber		^identificationNumber ! !!Customer methodsFor: 'addresses' stamp: 'HernanWilkinson 10/28/2016 13:27'!addAddress: anAddress 	addresses add: anAddress ! !!Customer methodsFor: 'addresses' stamp: 'JulianBayardo 11/7/2017 00:29'!addresses	^ addresses asSet.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Customer class	instanceVariableNames: ''!!Customer class methodsFor: 'accessing' stamp: 'JulianBayardo 11/7/2017 00:18'!first: aFirstName last: aLastName identificationType: anIdentificationType identificationNumber: anIdentificationNumber	^ self new initializeFirst: aFirstName last: aLastName identificationType: anIdentificationType identificationNumber: anIdentificationNumber .! !TestCase subclass: #CustomerImportTest	instanceVariableNames: 'inputStream session'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!CustomerImportTest methodsFor: 'running' stamp: 'JulianBayardo 11/7/2017 00:40'!setUp	inputStream := self instanceCustomerDatabaseStream.	session := DataBaseSession		for:			(Array				with:					(ClassMapping						withDefaultTableNameFor: Address						mappingAll:							(Array								with: (EmbededMapping withDefaultFieldNameFor: #streetName)								with: (EmbededMapping withDefaultFieldNameFor: #streetNumber)								with: (EmbededMapping withDefaultFieldNameFor: #town)								with: (EmbededMapping withDefaultFieldNameFor: #zipCode)								with: (EmbededMapping withDefaultFieldNameFor: #province)))				with:					(ClassMapping						withDefaultTableNameFor: Customer						mappingAll:							(Array								with: (EmbededMapping withDefaultFieldNameFor: #firstName)								with: (EmbededMapping withDefaultFieldNameFor: #lastName)								with: (EmbededMapping withDefaultFieldNameFor: #identificationType)								with: (EmbededMapping withDefaultFieldNameFor: #identificationNumber)								with: (OneToManyMapping withDefaultFieldNameFor: #addresses ofType: Address)))).	session open.	session beginTransaction! !!CustomerImportTest methodsFor: 'running' stamp: 'DamianFurman 11/6/2017 20:03'!tearDown	session commit.	session close.	inputStream close! !!CustomerImportTest methodsFor: 'data' stamp: 'JulianBayardo 11/7/2017 00:46'!importCustomers	"	self importCustomers	"	| newCustomer line |	line := inputStream nextLine.	[ line notNil ]		whileTrue: [ (line beginsWith: 'C')				ifTrue: [ | customerData |					customerData := line substrings: {$,}.					newCustomer := Customer						first: customerData second						last: customerData third						identificationType: customerData fourth						identificationNumber: customerData fifth.					session persist: newCustomer ].			(line beginsWith: 'A')				ifTrue: [ | addressData newAddress |					addressData := line substrings: {$,}.					newAddress := Address						street: addressData second						number: addressData third asInteger						town: addressData fourth						province: addressData sixth						zipCode: addressData fifth asInteger.					newCustomer addAddress: newAddress ].			line := inputStream nextLine ]! !!CustomerImportTest methodsFor: 'data' stamp: 'JulianBayardo 11/7/2017 00:39'!instanceCustomerDatabaseStream	^ ReadStream		on:			'C,Pepe,Sanchez,D,22333444A,San Martin,3322,Olivos,1636,BsAsA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImportTest methodsFor: 'data' stamp: 'JulianBayardo 11/7/2017 00:33'!instancePerez	| customer |	customer := Customer		first: 'Juan'		last: 'Perez'		identificationType: 'C'		identificationNumber: '23-25666777-9'.	customer		addAddress:			(Address				street: 'Alem'				number: 1122				town: 'CABA'				province: 'CABA'				zipCode: 1001).	^ customer! !!CustomerImportTest methodsFor: 'data' stamp: 'JulianBayardo 11/7/2017 00:31'!instancePepe	| customer |	customer := Customer		first: 'Pepe'		last: 'Sanchez'		identificationType: 'D'		identificationNumber: '22333444'.	customer		addAddress:			(Address				street: 'San Martin'				number: 3322				town: 'Olivos'				province: 'BsAs'				zipCode: 1636).	customer		addAddress:			(Address				street: 'Maipu'				number: 888				town: 'Florida'				province: 'Buenos Aires'				zipCode: 1122).	^ customer.! !!CustomerImportTest methodsFor: 'tests' stamp: 'JulianBayardo 11/7/2017 00:35'!test00hasAllCustomers	self importCustomers.	self assert: (session selectAllOfType: Customer) size equals: 2! !!CustomerImportTest methodsFor: 'tests' stamp: 'JulianBayardo 11/7/2017 00:50'!test02containsJuanAndAddresses	| searchResults |	self importCustomers.	searchResults := session select: [ :aCustomer | aCustomer firstName = 'Juan' ] ofType: Customer.	self assert: searchResults size equals: 1.	self assert: (searchResults at: 1) equals: self instancePerez! !!CustomerImportTest methodsFor: 'tests' stamp: 'JulianBayardo 11/7/2017 00:50'!test01containsPepeAndAddresses	| searchResults |	self importCustomers.	searchResults := session		select: [ :aCustomer | aCustomer firstName = 'Pepe' ]		ofType: Customer.	self assert: searchResults size equals: 1.	self assert: (searchResults at: 1) equals: self instancePepe! !